
/****** Object:  StoredProcedure [dbo].[ChaosCastleFinal_Save]    Script Date: 12/09/2020 05:37:13 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER OFF
GO




CREATE PROC [dbo].[ChaosCastleFinal_Save]
	@mName			VARCHAR(10)
,	@mPoint			INT
,	@mCharClass		INT
,	@mCharLevel		INT
,	@mCharExp		BIGINT
,	@mCCFType		TINYINT
AS
    SET NOCOUNT ON
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

	DECLARE	 
				 @aRowCnt		INT
				,@aErrNo		INT
				,@Result		TINYINT
	SELECT		 
				 @aRowCnt = 0
				,@aErrNo = 0
				,@Result = 1

	UPDATE dbo.ChaosCastleFinal_Scores SET mPoint = mPoint + @mPoint, mCharClass = @mCharClass, mCharLevel = @mCharLevel, mCharExperience = @mCharExp, mDate = GETDATE() WHERE mName = @mName AND mCCFType = @mCCFType 
	SELECT @aErrNo = @@ERROR, @aRowCnt = @@ROWCOUNT
	IF (@aErrNo <> 0)
	BEGIN
		SET @Result = -1
		SELECT @Result
		RETURN 
	END
		
	IF (@aRowCnt = 0)
	BEGIN
		INSERT INTO dbo.ChaosCastleFinal_Scores ( mName, mCCFType, mPoint, mCharClass, mCharLevel, mCharExperience, mDate ) 
		VALUES ( @mName, @mCCFType,@mPoint, @mCharClass, @mCharLevel, @mCharExp, GETDATE() )
		SELECT @aErrNo = @@ERROR, @aRowCnt = @@ROWCOUNT
		IF ( @aErrNo <> 0 OR @aRowCnt = 0)
		BEGIN
			SET @Result = -2
			SELECT @Result
			RETURN
		END
	END

	SET @Result = 0
	SELECT @Result
	RETURN



GO


